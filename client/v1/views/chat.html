
  <div ng-controller="ChatCtrl" ng-cloak="">
    <span ng-include="'views/header.html'"></span>

  
  <!-- stylesheets are conveniently separated into components -->
	<link rel="stylesheet" media="all" href="../component/styles/setup.css">
	<link rel="stylesheet" media="all" href="../component/styles/says.css">
	<link rel="stylesheet" media="all" href="../component/styles/reply.css">
	<link rel="stylesheet" media="all" href="../component/styles/typing.css">
	<link rel="stylesheet" media="all" href="../component/styles/input.css">
	<!-- <style>
	body {
		background: #dcdde0;
	}
	.bubble-container {
		height: 100vh;
	}
	.bubble-container .input-wrap textarea {
		margin: 0;
		width: calc(100% - 30px);
	}
    </style> -->
     
 
<div class="">
    <br>  
<div id="chat" class ="card-panel z-depth-5"></div>
    <br>
</div>



<script src="../component/Bubbles.js"></script>
<script>
var chatWindow = new Bubbles(document.getElementById("chat"), "chatWindow", {
  inputCallbackFn: function(o) {
    // add error conversation block & recall it if no answer matched
    var miss = function() {
      chatWindow.talk(
        {
          "i-dont-get-it": {
            says: [
              "Sorry, I don't get it üòï. Pls repeat? Or you can just click below üëá"
            ],
            reply: o.convo[o.standingAnswer].reply
          }
        },
        "i-dont-get-it"
      )
    }

    // do this if answer found
    var match = function(key) {
      setTimeout(function() {
        chatWindow.talk(convo, key) // restart current convo from point found in the answer
      }, 600)
    }

    // sanitize text for search function
    var strip = function(text) {

      //replace with ajax request from ProNav

      mixpanel.track(text);
      return text.toLowerCase().replace(/[\s.,\/#!$%\^&\*;:{}=\-_'"`~()]/g, "")
    }

    // search function
    var found = false
    o.convo[o.standingAnswer].reply.forEach(function(e, i) {
      strip(e.question).includes(strip(o.input)) && o.input.length > 0
        ? (found = e.answer)
        : found ? null : (found = false)
    })
    found ? match(found) : miss()
  }
}) // done setting up chat-bubble


// var convo =
// {
//   ice :{
//     says:["Hello",
//     "My name is blah",
//     "2 blah",
//     "What do you want to do?"],
//     reply:[
//     {
//         question: "buy", // label for the reply option
//         answer: "buy" // key for the next conversation object
//        },
//        {
//         question: "claim", // label for the reply option
//         answer: "claim" // key for the next conversation object
//        }
//     ],
//     buy:{
//       says: ["Excellent!"]        
//     }
//   }
// }



var convo = {
  // "ice" (as in "breaking the ice") is a required conversation object
  // that maps the first thing the bot will say to the user
  ice: {
    // "says" defines an array of sequential bubbles
    // that the bot will produce
    says: [
      "Hello {{bdr}}!",
      "Let's explore advanced chat flows with <em>Ask Sage</em>.",
      "In this example you'll see how this simple chatbot can help you create advanced conversational sequences.",
      "To begin, choose how you'd like this (example) conversation to proceed...",
      "...We can either talk about <b>Buying insurance</b> or <b>Making a claim </b> or <b>Inquire a status claim</b>. Which one shall it be?",
      "<img src=../img/wawa.png />"
    ],
    // "reply" is an array of possible options the user can pick from
    // as a reply
    reply: [
      {
        question: "Bananas and ice cream!", // label for the reply option
        answer: "chapter-one" // key for the next conversation object
      },
      {
        question: "No, thanks.", // label for the reply option
        answer: "end" // key for an "escape valve"; we refer to this whenever a reply signals the end of the convo
      },
      {
        question: "What ‚Äúother special things?‚Äù", // label for the reply option
        answer: "sidetrack" // key for a "side note" we can reference from multiple points in the chat
      }
    ]
  }, // end required "ice" conversation object
  // side note
  sidetrack: {
    says: [
      "Things which go way beyond a single topic of conversation!",
      "<img src=https://meanbusiness.com/wp-content/uploads/2018/04/Walk-Cycle-Banana-Jelly-Bean-GIF-by-Ethan-Barnowsky-source.gif />",
      "As in this case we are branching out from the main topic of ‚Äúbananas and ice cream‚Äù into another series of prompts and possible replies.",
      "This could be a useful way provide more instructions or context."
    ],
    reply: [
      {
        question: "Tell me more.",
        answer: "intro-context" // key for another side note; in this instance, we're using it to contextualize the Q&A we're heading into
      },
      {
        question: "Got it: on with the chat!",
        answer: "chapter-one" // no further sidetrack required, returning to the main conversation tree
      }
    ]
  },
  // another side note
  "intro-context": {
    says: [
      "This is an example of further instructions...",
      "...Context and side-notes...",
      "...With a way to return back to the main trunk of the conversation, like so:"
    ],
    reply: [
      {
        question: "To the main topic, bananas and ice cream!",
        answer: "chapter-one"
      }
    ]
  },
  // main conversation trunk
  "chapter-one": {
    says: [
      "Excellent!",
      "(This is the main topic of our chat.)",
      "Bananas and ice cream.",
      "Now, which do you prefer best?"
    ],
    reply: [
      {
        question: "Bananas!",
        answer: "chapter-two" // here both replies send people onto the same next chapter
      },
      {
        question: "Ice cream!", // both replies send people onto the same next chapter
        answer: "chapter-two"
      },
      {
        question: "What‚Äôs this button?",
        answer: "intro-context"
      }
    ]
  },
  "chapter-two": {
    says: [
      "Both <strong>bananas</strong> and <strong>ice cream</strong> take you here.",
      "<img src=https://meanbusiness.com/wp-content/uploads/2018/04/IceCream-MultipleCones.gif />",
      "Your next answer will take you to another prompt...",
      "...Or to the end of the chat, an ‚Äúescape valve‚Äù we can use to end the chat if you want."
    ],
    reply: [
      {
        question: "Give me another prompt.",
        answer: "chapter-four"
      },
      {
        question: "End the chat.",
        answer: "end" // an example of using the Escape Valve for ineligible, Not Applicable participants
      }
    ]
  },
  // this chapter is skipped
  "chapter-three": {
    // we skip this in this example to show you can do that; use it if you want.
    says: [
      "Go ahead to the next chapter.",
      "<img src=http://meanbusiness.com/wp-content/uploads/2018/03/Coral-Participate-Phone_and_Laptop.jpg />"
    ],
    reply: [
      {
        question: "OK, I will.",
        answer: "chapter-four"
      }
    ]
  },
  // continue with main conversation trunk
  "chapter-four": {
    says: [
      "Hey, you're awesome!",
      "<img src=http://meanbusiness.com/wp-content/uploads/2018/02/mel_b-Thank-You.gif />",
      "More prompts?"
    ],
    reply: [
      {
        question: "Nope.",
        answer: "end"
      },
      {
        question: "Yes, more prompts!",
        answer: "chapter-five"
      }
    ]
  },
  "chapter-five": {
    says: [
      "Answering 'Yes' here will open a new window with a page from another site...", // call a function to an external resource / application outside of chat-bubble's purview
      "...And confirm that you're awesome, again.",
      "Answering 'Not interested' will end the chat." // call a function to an external resource / application outside of chat-bubble's purview
    ],
    reply: [
      {
        question: "Not interested.",
        answer: "end"
      },
      {
        question: "Yes!",
        answer: "externalResourceFunction" // function name that will be executed
      }
    ]
  },
  end: {
    says: [
      "Thanks for your time and attention.",
      "<img src=https://media.giphy.com/media/xUOxeXsWhw6DCW1cSA/giphy.gif>",
      "The chat is over, but you can <strong>start over</strong> to see how this conversation could have gone differently."
    ],
    reply: [
      {
        question: "Start over üòÅ",
        answer: "ice"
      }
    ]
  }
} // end conversation object

// pass JSON to your function and you're done!
chatWindow.talk(convo)
</script>

<span ng-include="'views/footer.html'"></span>